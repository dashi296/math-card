# 音声認識アーキテクチャ

音声認識機能(`features/voice-recognition/`)は、関心事の明確な分離を持つアーキテクチャで構成されています。

## Modelレイヤー (`model/use-voice-number-recognition.ts`)

### 責務

- 音声認識状態とライフサイクルを管理
- expo-speech-recognitionイベント(start、end、result、error)を処理

### ベストマッチ選択アルゴリズム

- `maxAlternatives: 10`で複数の候補を受信
- 数字関連キーワードに基づいて各候補をスコアリング
- 最も可能性の高い数字を自動選択
- 迅速な入力のための継続モードをサポート

### 設定

- `lang`: "ja-JP"
- `interimResults`: true(リアルタイムフィードバック)
- `maxAlternatives`: 10(ベストマッチ選択用)
- `continuous`: true(短い発音認識の改善)
- `contextualStrings`: 日本語数字の広範なリスト
- `iosTaskHint`: "dictation"(iOS最適化)

## Libraryレイヤー (`lib/japanese-number/`)

### 責務

- 日本語数字解析用の純粋関数
- 複雑な複数桁の数字を処理(例: "二千三百四十五" → "2345")
- 複数形式をサポート: ひらがな、カタカナ、漢字、アラビア数字

### スコアリングシステム

候補選択用のスコアリング:

- 数字キーワード: 各+10ポイント
- 数字に変換可能: +50ポイント
- アラビア数字を含む: +30ポイント
- 単一文字(非数字): -20ポイント
- ノイズワード(です、は、など): 各-15ポイント

### ファジーマッチング

- 音韻的に類似した日本語発音のファジーマッチング
- 発音の揺れに対応して認識精度を向上

## UIレイヤー (`ui/voice-number-recognition.tsx`)

### 責務

- プレゼンテーションレイヤーのみ
- 認識状態、暫定結果、最終結果を表示
- ユーザーコントロールを提供(開始、停止、継続モード、クリア)

### 設計原則

- ビジネスロジックなし - カスタムhookに委譲
- 純粋なUIコンポーネントとして実装
