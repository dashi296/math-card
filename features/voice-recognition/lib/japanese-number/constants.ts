/**
 * Constants for Japanese number parsing
 */

import type { NumberMap, PhoneticMap } from './types';

// ========================================
// Threshold constants
// ========================================

/** ファジーマッチングの類似度閾値 */
export const FUZZY_MATCH_THRESHOLD = 0.6;
export const UNIT_FUZZY_MATCH_THRESHOLD = 0.5;
export const PARTIAL_MATCH_SIMILARITY = 0.7;

/** スコアリング定数 */
export const SCORE = {
  KEYWORD_MATCH: 10,
  FUZZY_MATCH_BASE: 5,
  NUMBER_CONVERSION: 50,
  ARABIC_NUMERAL: 30,
  SINGLE_CHAR_PENALTY: -20,
  NOISE_WORD_PENALTY: -15,
  // 新規追加: 長い表現と複合数字を優先
  LENGTH_BONUS_PER_CHAR: 2, // 文字数が多いほど高スコア
  COMPOUND_NUMBER_BONUS: 25, // 十、百、千を含む表現に追加ボーナス
  SHORT_TEXT_PENALTY: -30, // 2文字以下の非アラビア数字に強いペナルティ
} as const;

/** ノイズワード */
export const NOISE_WORDS = [
  'です',
  'ます',
  'でした',
  'ました',
  'は',
  'が',
  'を',
  'の',
  'と',
] as const;

/**
 * 音声認識の誤認識パターン→正しい数字表現への変換マップ
 *
 * 音声認識エンジンが数字を誤って他の単語として認識する場合に、
 * 正しい数字表現に変換するためのマッピング
 */
export const MISRECOGNITION_MAP: Record<string, string> = {
  // 14（じゅうし/じゅうよん）の誤認識
  中止: 'じゅうし',
  重視: 'じゅうし',
  住所: 'じゅうし',
  充実: 'じゅうし',
  従事: 'じゅうし',
  注視: 'じゅうし',
  宙止: 'じゅうし',
  ちゅうし: 'じゅうし',
  チュウシ: 'じゅうし',

  // 4（し/よん）の誤認識
  死: 'し',
  シー: 'し',
  詩: 'し',
  私: 'し',

  // 7（しち/なな）の誤認識
  質: 'しち',
  日: 'なな',
  市: 'しち',

  // 10（じゅう）の誤認識
  住: 'じゅう',
  十: 'じゅう',
  重: 'じゅう',
  ちゅう: 'じゅう',
  チュウ: 'じゅう',

  // 11（じゅういち）の誤認識
  十一: 'じゅういち',
  重一: 'じゅういち',

  // 12（じゅうに）の誤認識
  十二: 'じゅうに',
  重荷: 'じゅうに',

  // その他よくある誤認識
  一致: 'いち',
  位置: 'いち',
  ニー: 'に',
  三分: 'さん',
  後: 'ご',
  語: 'ご',
  五後: 'ご',
  六区: 'ろく',
};

// ========================================
// Mapping constants
// ========================================

/** カタカナ→ひらがな変換マッピング（数字関連のみ） */
export const katakanaToHiragana: Record<string, string> = {
  ゼロ: 'ぜろ',
  イチ: 'いち',
  ニ: 'に',
  サン: 'さん',
  シ: 'し',
  ヨン: 'よん',
  ゴ: 'ご',
  ロク: 'ろく',
  シチ: 'しち',
  ナナ: 'なな',
  ハチ: 'はち',
  キュウ: 'きゅう',
  ク: 'く',
  ジュウ: 'じゅう',
  ヒャク: 'ひゃく',
  セン: 'せん',
  マン: 'まん',
};

/**
 * 音韻類似度マッピング
 *
 * 不正確な発声や音声認識エラーに対応するため、
 * 各数字の似た音のバリエーションを定義
 */
export const phoneticSimilarity: PhoneticMap = {
  // いち系
  いち: ['いっ', 'い', 'いち', 'いっち'],
  イチ: ['イッ', 'イ', 'イチ', 'イッチ'],
  // に系
  に: ['に', 'にい', 'にー'],
  ニ: ['ニ', 'ニー'],
  // さん系
  さん: ['さん', 'さ', 'さーん', 'さあん'],
  サン: ['サン', 'サ', 'サーン'],
  // し/よん系
  し: ['し', 'しー', 'しぃ'],
  よん: ['よん', 'よ', 'よーん', 'よおん'],
  ヨン: ['ヨン', 'ヨ', 'ヨーン'],
  // ご系
  ご: ['ご', 'ごー', 'ごお'],
  ゴ: ['ゴ', 'ゴー'],
  // ろく系
  ろく: ['ろく', 'ろ', 'ろっ', 'ろーく'],
  ロク: ['ロク', 'ロ', 'ロッ', 'ローク'],
  // しち/なな系
  しち: ['しち', 'し', 'しっち', 'しーち'],
  なな: ['なな', 'な', 'なーな', 'なあな'],
  ナナ: ['ナナ', 'ナ', 'ナーナ'],
  // はち系
  はち: ['はち', 'は', 'はっ', 'はーち', 'はっち'],
  ハチ: ['ハチ', 'ハ', 'ハッ', 'ハーチ'],
  // きゅう/く系
  きゅう: ['きゅう', 'きゅ', 'きゅー', 'きゅうう'],
  く: ['く', 'くー', 'くう'],
  キュウ: ['キュウ', 'キュ', 'キュー'],
  ク: ['ク', 'クー'],
  // じゅう系（ちゅうとの混同対策）
  じゅう: ['じゅう', 'じゅ', 'じゅー', 'じゅうう', 'じゅーう', 'ちゅう', 'ちゅ', 'ちゅー'],
  ジュウ: ['ジュウ', 'ジュ', 'ジュー', 'チュウ', 'チュ', 'チュー'],
  // 複合数字（10-19）の音韻バリエーション
  じゅうし: ['じゅうし', 'じゅーし', 'じゅし', 'ちゅうし', 'ちゅーし', 'ちゅし'],
  じゅうよん: ['じゅうよん', 'じゅーよん', 'じゅよん', 'ちゅうよん', 'ちゅーよん'],
  じゅういち: ['じゅういち', 'じゅーいち', 'じゅいち', 'ちゅういち'],
  じゅうに: ['じゅうに', 'じゅーに', 'じゅに', 'ちゅうに'],
  じゅうさん: ['じゅうさん', 'じゅーさん', 'じゅさん', 'ちゅうさん'],
  じゅうご: ['じゅうご', 'じゅーご', 'じゅご', 'ちゅうご'],
  じゅうろく: ['じゅうろく', 'じゅーろく', 'じゅろく', 'ちゅうろく'],
  じゅうしち: ['じゅうしち', 'じゅーしち', 'じゅしち', 'ちゅうしち'],
  じゅうなな: ['じゅうなな', 'じゅーなな', 'じゅなな', 'ちゅうなな'],
  じゅうはち: ['じゅうはち', 'じゅーはち', 'じゅはち', 'ちゅうはち'],
  じゅうきゅう: ['じゅうきゅう', 'じゅーきゅう', 'じゅきゅう', 'ちゅうきゅう'],
  じゅうく: ['じゅうく', 'じゅーく', 'じゅく', 'ちゅうく'],
  // ひゃく系
  ひゃく: ['ひゃく', 'ひゃ', 'ひゃーく', 'ひゃっ', 'ひゃくく'],
  ヒャク: ['ヒャク', 'ヒャ', 'ヒャーク'],
  // せん系
  せん: ['せん', 'せ', 'せーん', 'せえん', 'せんん'],
  セン: ['セン', 'セ', 'セーン'],
  // まん系
  まん: ['まん', 'ま', 'まーん', 'まあん'],
  マン: ['マン', 'マ', 'マーン'],
};

/**
 * 基本数字マッピング（0-9 + 10-19の複合数字）
 */
export const kanjiToNum: NumberMap = {
  零: 0,
  ゼロ: 0,
  れい: 0,
  レイ: 0,
  一: 1,
  いち: 1,
  イチ: 1,
  壱: 1,
  二: 2,
  に: 2,
  ニ: 2,
  弐: 2,
  三: 3,
  さん: 3,
  サン: 3,
  参: 3,
  四: 4,
  し: 4,
  よん: 4,
  シ: 4,
  ヨン: 4,
  五: 5,
  ご: 5,
  ゴ: 5,
  六: 6,
  ろく: 6,
  ロク: 6,
  七: 7,
  しち: 7,
  なな: 7,
  シチ: 7,
  ナナ: 7,
  八: 8,
  はち: 8,
  ハチ: 8,
  九: 9,
  きゅう: 9,
  く: 9,
  キュウ: 9,
  ク: 9,
  // 10-19の複合数字（よく使われるため直接マッピング）
  じゅう: 10,
  十: 10,
  ジュウ: 10,
  じゅういち: 11,
  十一: 11,
  じゅうに: 12,
  十二: 12,
  じゅうさん: 13,
  十三: 13,
  じゅうし: 14,
  じゅうよん: 14,
  十四: 14,
  じゅうご: 15,
  十五: 15,
  じゅうろく: 16,
  十六: 16,
  じゅうしち: 17,
  じゅうなな: 17,
  十七: 17,
  じゅうはち: 18,
  十八: 18,
  じゅうきゅう: 19,
  じゅうく: 19,
  十九: 19,
};

/**
 * 位取り単位マッピング
 */
export const unitToMultiplier: NumberMap = {
  十: 10,
  じゅう: 10,
  ジュウ: 10,
  百: 100,
  ひゃく: 100,
  ヒャク: 100,
  千: 1000,
  せん: 1000,
  セン: 1000,
  万: 10000,
  まん: 10000,
  マン: 10000,
};
